/*
 * Required Notice: Â© Copyright 2025 KSEC - Erez Kalman (kaerez[at]gmail[dot]com | www.kalman.co.il | https://github.com/zeno-security/zeno | https://github.com/kaerez)
 *
 * This software is licensed under the PolyForm Strict License 1.0.0.
 * You may obtain a copy of the License at:
 * * https://polyformproject.org/licenses/strict/1.0.0/
 *
 * SPDX-License-Identifier: PolyForm-Strict-1.0.0
 */

(function(){"use strict";let o;function a(n){const e=o.__externref_table_alloc();return o.__wbindgen_externrefs.set(e,n),e}function h(n,e){return n=n>>>0,b().subarray(n/1,n/1+e)}function m(n,e){return n=n>>>0,R(n,e)}let f=null;function b(){return(f===null||f.byteLength===0)&&(f=new Uint8Array(o.memory.buffer)),f}function u(n,e){try{return n.apply(this,e)}catch(t){const r=a(t);o.__wbindgen_exn_store(r)}}function l(n){return n==null}function E(n,e,t){if(t===void 0){const i=w.encode(n),_=e(i.length,1)>>>0;return b().subarray(_,_+i.length).set(i),y=i.length,_}let r=n.length,c=e(r,1)>>>0;const g=b();let s=0;for(;s<r;s++){const i=n.charCodeAt(s);if(i>127)break;g[c+s]=i}if(s!==r){s!==0&&(n=n.slice(s)),c=t(c,r,r=s+n.length*3,1)>>>0;const i=b().subarray(c+s,c+r),_=w.encodeInto(n,i);s+=_.written,c=t(c,r,s,1)>>>0}return y=s,c}function S(n){const e=o.__wbindgen_externrefs.get(n);return o.__externref_table_dealloc(n),e}let d=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});d.decode();const x=2146435072;let p=0;function R(n,e){return p+=e,p>=x&&(d=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),d.decode(),p=e),d.decode(b().subarray(n,n+e))}const w=new TextEncoder;"encodeInto"in w||(w.encodeInto=function(n,e){const t=w.encode(n);return e.set(t),{read:n.length,written:t.length}});let y=0;function O(n,e,t,r){const c=E(n,o.__wbindgen_malloc,o.__wbindgen_realloc),g=y,s=E(e,o.__wbindgen_malloc,o.__wbindgen_realloc),i=y,_=o.solve_wasm(c,g,s,i,t,r);if(_[2])throw S(_[1]);return S(_[0])}const v=new Set(["basic","cors","default"]);async function W(n,e){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,e)}catch(r){if(n.ok&&v.has(n.type)&&n.headers.get("Content-Type")!=="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",r);else throw r}const t=await n.arrayBuffer();return await WebAssembly.instantiate(t,e)}else{const t=await WebAssembly.instantiate(n,e);return t instanceof WebAssembly.Instance?{instance:t,module:n}:t}}function L(){const n={};return n.wbg={},n.wbg.__wbg___wbindgen_is_function_8d400b8b1af978cd=function(e){return typeof e=="function"},n.wbg.__wbg___wbindgen_is_object_ce774f3490692386=function(e){const t=e;return typeof t=="object"&&t!==null},n.wbg.__wbg___wbindgen_is_string_704ef9c8fc131030=function(e){return typeof e=="string"},n.wbg.__wbg___wbindgen_is_undefined_f6b95eab589e0269=function(e){return e===void 0},n.wbg.__wbg___wbindgen_throw_dd24417ed36fc46e=function(e,t){throw new Error(m(e,t))},n.wbg.__wbg_call_3020136f7a2d6e44=function(){return u(function(e,t,r){return e.call(t,r)},arguments)},n.wbg.__wbg_call_abb4ff46ce38be40=function(){return u(function(e,t){return e.call(t)},arguments)},n.wbg.__wbg_crypto_574e78ad8b13b65f=function(e){return e.crypto},n.wbg.__wbg_getRandomValues_b8f5dbd5f3995a9e=function(){return u(function(e,t){e.getRandomValues(t)},arguments)},n.wbg.__wbg_length_22ac23eaec9d8053=function(e){return e.length},n.wbg.__wbg_msCrypto_a61aeb35a24c1329=function(e){return e.msCrypto},n.wbg.__wbg_new_1ba21ce319a06297=function(){return new Object},n.wbg.__wbg_new_25f239778d6112b9=function(){return new Array},n.wbg.__wbg_new_no_args_cb138f77cf6151ee=function(e,t){return new Function(m(e,t))},n.wbg.__wbg_new_with_length_aa5eaf41d35235e5=function(e){return new Uint8Array(e>>>0)},n.wbg.__wbg_node_905d3e251edff8a2=function(e){return e.node},n.wbg.__wbg_process_dc0fbacc7c1c06f7=function(e){return e.process},n.wbg.__wbg_prototypesetcall_dfe9b766cdc1f1fd=function(e,t,r){Uint8Array.prototype.set.call(h(e,t),r)},n.wbg.__wbg_randomFillSync_ac0988aba3254290=function(){return u(function(e,t){e.randomFillSync(t)},arguments)},n.wbg.__wbg_require_60cc747a6bc5215a=function(){return u(function(){return module.require},arguments)},n.wbg.__wbg_set_3fda3bac07393de4=function(e,t,r){e[t]=r},n.wbg.__wbg_set_7df433eea03a5c14=function(e,t,r){e[t>>>0]=r},n.wbg.__wbg_static_accessor_GLOBAL_769e6b65d6557335=function(){const e=typeof global>"u"?null:global;return l(e)?0:a(e)},n.wbg.__wbg_static_accessor_GLOBAL_THIS_60cf02db4de8e1c1=function(){const e=typeof globalThis>"u"?null:globalThis;return l(e)?0:a(e)},n.wbg.__wbg_static_accessor_SELF_08f5a74c69739274=function(){const e=typeof self>"u"?null:self;return l(e)?0:a(e)},n.wbg.__wbg_static_accessor_WINDOW_a8924b26aa92d024=function(){const e=typeof window>"u"?null:window;return l(e)?0:a(e)},n.wbg.__wbg_subarray_845f2f5bce7d061a=function(e,t,r){return e.subarray(t>>>0,r>>>0)},n.wbg.__wbg_versions_c01dfd4722a88165=function(e){return e.versions},n.wbg.__wbindgen_cast_2241b6af4c4b2941=function(e,t){return m(e,t)},n.wbg.__wbindgen_cast_cb9088102bce6b30=function(e,t){return h(e,t)},n.wbg.__wbindgen_cast_d6cd19b81560fd6e=function(e){return e},n.wbg.__wbindgen_init_externref_table=function(){const e=o.__wbindgen_externrefs,t=e.grow(4);e.set(0,void 0),e.set(t+0,void 0),e.set(t+1,null),e.set(t+2,!0),e.set(t+3,!1)},n}function F(n,e){return o=n.exports,A.__wbindgen_wasm_module=e,f=null,o.__wbindgen_start(),o}async function A(n){if(o!==void 0)return o;typeof n<"u"&&(Object.getPrototypeOf(n)===Object.prototype?{module_or_path:n}=n:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof n>"u"&&(n=new URL("zeno.wasm",self.location));const e=L();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:t,module:r}=await W(await n,e);return F(t,r)}let T=!1;self.onmessage=async n=>{const{type:e,challenge:t,wasm_url:r}=n.data;if(e==="SOLVE")try{T||(await A(r||"zeno.wasm"),T=!0),console.log("Starting Zeno Solver...");const c=O(t.seed,t.discriminant,BigInt(t.vdf),t.graph_bits),g=c.memory_bytes||0;self.postMessage({type:"SOLVED",payload:c,memory:g})}catch(c){console.error("Solver Error:",c),self.postMessage({type:"ERROR",error:c.toString()})}}})();
